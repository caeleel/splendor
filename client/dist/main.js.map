{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/index.tsx","webpack:///external \"React\"","webpack:///external \"ReactDOM\"","webpack:///./node_modules/favico.js/favico.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","globalShowError","resp","errorTimeout","colors","gemColors","concat","levelNames","mapColors","gems","game","callback","symbol","uuid","map","color","cName","className","onClick","mapNobles","nobles","noble","Noble","Card","React","PureComponent","card","this","props","buyer","buy","reserver","e","preventDefault","reserve","level","id","src","points","cost","visit","requirement","Player","state","editingName","editName","setState","target","focusName","select","submitName","rename","keypress","pid","playerSelector","selectPlayer","collection","set","cards","length","stats","Fragment","you","youName","discard","reserved","reservedCount","nreserved","type","autoFocus","onKeyPress","onFocus","onBlur","onChange","turn","selectedPlayer","Level","remaining","Game","players","chat","decks","log","winner","error","phase","showChat","showLog","chatNotify","isMyTurn","updateState","favicon","badge","document","getElementById","play","alert","lastLocalChat","lastRemoteChat","msg","scroller","getElementsByClassName","scrollTop","scrollHeight","loginArgs","take","act","confirm","player","fetch","gid","method","json","action","nextTurn","poll","stat","chatBox","which","body","JSON","stringify","score","logLine","chatLine","levels","style","bottom","opacity","ErrorMsg","GameCreator","startKey","loading","lobby","joined","gameName","errorOpacity","creating","join","session","readSession","save","status","showError","createGame","result","clear","clearTimeout","setTimeout","history","replaceState","start","window","localStorage","getItem","parse","saveRaw","startGame","nameChange","keyPress","location","pathname","then","substring","href","Favico","position","onclick","ReactDOM","render","opt","_opt","_orig","_h","_w","_canvas","_context","_img","_ready","_lastBadge","_running","_readyCb","_stop","_browser","_animTimeout","_drawTimeout","_doc","_def","bgColor","textColor","fontFamily","fontStyle","animation","elementId","dataUrl","win","ff","InstallTrigger","chrome","opera","navigator","userAgent","indexOf","ie","safari","toString","HTMLElement","supported","_queue","icon","reset","clearRect","drawImage","link","setIcon","run","forEach","a","options","shift","Math","abs","x","y","w","h","len","circle","more","beginPath","font","floor","textAlign","moveTo","lineTo","quadraticCurveTo","arc","PI","fillStyle","g","b","fill","closePath","stroke","fillText","rectangle","fillRect","drawVideo","video","paused","ended","duration","hexToRgb","hex","replace","exec","parseInt","merge","def","attrname","mergedOpt","getIcon","elm","element","setAttribute","getAttribute","getElementsByTagName","test","getLink","createElement","appendChild","canvas","url","toDataURL","old","parentNode","removeChild","types","fade","none","pop","popFade","slide","cb","revert","step","animationType","hidden","msHidden","webkitHidden","mozHidden","toLowerCase","isUp","isLeft","hasAttribute","onload","height","width","getContext","ready","init","number","opts","q","push","Error","message","videoElement","addEventListener","image","imageElement","newImg","ratio","webcam","URL","createObjectURL","obj","newVideo","getUserMedia","oGetUserMedia","msGetUserMedia","mozGetUserMedia","webkitGetUserMedia","audio","stream","browser"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import * as React from \"react\"\nimport * as ReactDOM from \"react-dom\"\nimport \"favico.js\"\n\ntype ColorT = 'w' | 'u' | 'g' | 'b' | 'r'\ntype GemT = ColorT | '*'\n\ninterface CostT {\n  w?: number\n  u?: number\n  g?: number\n  b?: number\n  r?: number\n}\n\ninterface GemsT extends CostT {\n  '*'?: number\n}\n\ninterface CardT {\n  color: string\n  points: number\n  uuid: string\n  cost: CostT\n  level: string\n}\n\ninterface CardsT {\n  w?: CardT[]\n  u?: CardT[]\n  g?: CardT[]\n  b?: CardT[]\n  r?: CardT[]\n}\n\ninterface NobleT {\n  id: number\n  points: number\n  uuid: string\n  requirement: CostT\n}\n\ninterface PlayerT {\n  id: number\n  name: string\n  uuid: string\n  reserved: CardT[]\n  nobles: NobleT[]\n  cards: CardsT\n  gems: GemsT\n  score: number\n}\n\ninterface LogT {\n  pid: number\n  time: number\n  msg: string\n}\n\ninterface GameT {\n  players: PlayerT[]\n  cards: { [level: string]: CardT[] }\n  decks: { [level: string]: number }\n  log: LogT[]\n  gems: GemsT\n  nobles: NobleT[]\n  winner: number | null\n  turn: number\n}\n\ninterface ChatT {\n  time: number\n  pid: number\n  name: string\n  msg: string\n}\n\ninterface GameState extends GameT {\n  mode: string\n  selectedPlayer: number\n  phase: string\n  showChat: boolean\n  showLog: boolean\n  chat: ChatT[]\n  chatNotify: boolean\n}\n\ninterface ServerResponse {\n  error?: string\n  state: GameT\n  chat: ChatT[]\n  status?: number\n  result: {\n    error?: string\n  }\n}\n\nlet globalShowError = (resp: ServerResponse) => { return false }\n\n(function () {\n  let errorTimeout = 0\n  const colors = ['b', 'u', 'w', 'g', 'r']\n  const gemColors = colors.concat(['*'])\n  const levelNames = ['level1', 'level2', 'level3']\n\n  function mapColors(gems: GemsT, game: Game, callback: (color: GemT) => void, symbol: string, uuid: string | number) {\n    return gemColors.map((color: GemT) => {\n      var cName = color + \"chip\"\n      if (color === '*') cName = \"schip\"\n      return (\n        <div className={\"gem \" + cName} key={color + \"_colors_\" + uuid}>\n          <div className=\"bubble\">{gems[color]}</div>\n          <div className=\"underlay\" onClick={callback.bind(game, color)}>{symbol}</div>\n        </div>\n      );\n    });\n  }\n\n  function mapNobles(nobles: NobleT[], game: Game) {\n    return nobles.map((noble) => {\n      return (\n        <Noble key={noble.uuid} noble={noble} game={game}/>\n      );\n    });\n  }\n\n  class Card extends React.PureComponent<{ card: CardT, game: Game }, {}> {\n    render() {\n      const card = this.props.card\n      const game = this.props.game\n      var buyer = game.buy.bind(game, card.uuid)\n      const reserver = (e: React.MouseEvent<HTMLDivElement>) => {\n        e.preventDefault();\n        game.reserve.bind(game)(card.uuid)\n      }\n\n      if (card.color) {\n        return (\n          <div\n            className={\"card card-\" + card.color + \" card-\" + card.level}\n            id={card.uuid}\n          >\n            <div className=\"reserve\" onClick={reserver}>\n              <img className=\"floppy\" src=\"client/img/floppy.png\" />\n            </div>\n            <div className=\"overlay\" onClick={buyer}></div>\n            <div className=\"underlay\">\n              <div className=\"header\">\n                <div className={\"color \" + card.color + \"gem\"}>\n                </div>\n                <div className=\"points\">\n                  {card.points > 0 && card.points}\n                </div>\n              </div>\n              <div className=\"costs\">\n                {colors.map((color: ColorT) => {\n                  if(card.cost[color] > 0) {\n                    return (\n                      <div\n                        key={card.uuid + \"_cost_\" + color}\n                        className={\"cost \" + color}\n                      >\n                        {card.cost[color]}\n                      </div>\n                    )\n                  }\n                })}\n              </div>\n            </div>\n          </div>\n        );\n      } else {\n        return (\n          <div className = {\"deck \" + card.level}></div>\n        )\n      }\n    }\n  }\n\n  class Noble extends React.PureComponent<{ noble: NobleT, game: Game }, {}> {\n    render() {\n      const noble = this.props.noble\n      const game = this.props.game\n      const visit = game.noble.bind(game, noble.uuid)\n\n      return (\n        <div className=\"noble\" onClick={visit} id={\"noble\" + noble.id}>\n          <div className=\"side-bar\">\n            <div className=\"points\">\n              {noble.points > 0 && noble.points}\n            </div>\n            <div className=\"requirement\">\n              {colors.map((color: ColorT) => {\n                if(noble.requirement[color] > 0) {\n                  return (\n                    <div\n                      key={noble.uuid + \"_req_\" + color}\n                      className={\"requires \" + color}\n                    >\n                      {noble.requirement[color]}\n                    </div>\n                  )\n                }\n              })}\n            </div>\n          </div>\n        </div>\n      );\n    }\n  }\n\n  interface PlayerProps {\n    game: Game\n    pid: number\n    cards: CardsT\n    gems: GemsT\n    name: string\n    points: number\n    nobles: NobleT[]\n    reserved: CardT[]\n    nreserved: number\n    selectedPlayer: number\n  }\n\n  class Player extends React.PureComponent<PlayerProps, { editingName: string | null }> {\n    state = { editingName: null as string | null }\n\n    editName = (e: React.ChangeEvent<HTMLInputElement>) => {\n      this.setState({ editingName: e.target.value })\n    }\n\n    focusName = (e: React.FocusEvent<HTMLInputElement>) => {\n      e.target.select()\n    }\n\n    submitName = () => {\n      this.props.game.rename(this.state.editingName);\n      this.setState({ editingName: null })\n    }\n\n    keypress = (e: React.KeyboardEvent<HTMLInputElement>) => {\n      if (e.key === \"Enter\") {\n        this.submitName()\n      }\n    }\n\n    render() {\n      const game = this.props.game\n      const pid = this.props.pid\n      const playerSelector = game.selectPlayer.bind(game, pid)\n      const collection: { [color: string]: { cards: number, gems: number } } = {}\n\n      gemColors.map((color: ColorT) => {\n        collection[color] = {'cards': 0, 'gems': this.props.gems[color]};\n      })\n\n      const set = colors.map((color: ColorT) => {\n        var cards = this.props.cards[color].map((card: CardT) => {\n          collection[color]['cards'] += 1;\n          return (\n            <div\n              key={pid + \"_card_\" + card.uuid}\n              className=\"colorSetInner\"\n            >\n              <Card key={card.uuid} card={card} game={game}/>\n            </div>\n          );\n        })\n        return (\n          <div key={pid + \"_set_\" + color} className=\"colorSet\">\n            {cards}\n            <div className={cards.length > 0 ? \"endcap\" : \"spacer\"}></div>\n          </div>\n        )\n      })\n\n      const stats = gemColors.map((color) => {\n        return (\n          <div className=\"statSet\" key={\"stat\" + color}>\n            <div className={`stat stat${color === '*' ? 'y' : color}`}>{collection[color]['gems'] + (color == '*' ? '' : ' / ' + collection[color]['cards'])}</div>\n            {color === '*' ? <React.Fragment /> : <div><img className=\"labelImg\" src=\"client/img/labels.png\" /></div>}\n          </div>\n        )\n      })\n\n      const you = (game.props.pid === pid ? \" you selected\" : \"\")\n      const youName = (game.props.pid === pid ? \" (you)\" : \"\")\n      const gems = mapColors(this.props.gems, game, game.discard, 'X', pid)\n      const reserved = this.props.reserved ? this.props.reserved.map((card) => {\n        return (\n          <Card key={card.uuid + \"_inner\"} card={card} game={game}/>\n        );\n      }) : []\n      const reservedCount = this.props.reserved ? reserved.length : this.props.nreserved\n      const nobles = mapNobles(this.props.nobles, game)\n\n      return (\n        <div className={\"player\" + you}>\n          <div className=\"playerHeader\">\n            <div className=\"playerPoints\">{this.props.points}</div>\n            {this.state.editingName == null ?\n              <>\n                <div className=\"playerName\" onClick={playerSelector}>{this.props.name}</div>\n                {game.props.pid === pid && this.state.editingName == null ?\n                  <div className=\"pencil\" onClick={() => this.setState({ editingName: this.props.name })}>✏️</div> : <React.Fragment />\n                }\n              </> :\n              <div className=\"playerName\">\n                <input className=\"nameInput\" type=\"text\" value={this.state.editingName} autoFocus={true} onKeyPress={this.keypress} onFocus={this.focusName} onBlur={this.submitName} onChange={this.editName} />\n              </div>\n            }\n            <div className=\"playerName2\">{youName}</div>\n            {game.state.turn === pid &&\n              <div className=\"turnIndicator\">&#8592;</div>\n            }\n          </div>\n          {game.state.selectedPlayer === pid ?\n            <div className=\"floater\">\n              <div className=\"cards\">\n                {set}\n              </div>\n              <div className=\"nobles\">\n                {nobles}\n              </div>\n              <div className=\"gems\">\n                {gems}\n              </div>\n              <div className=\"reserveArea\">\n                { reservedCount > 0 &&\n                  <div>\n                    <div className=\"reserveText\">\n                      reserved\n                    </div>\n                    <div className=\"reserveCards\">\n                      {reserved}\n                    </div>\n                  </div>\n                }\n              </div>\n            </div> :\n            <div className=\"stats\">\n              <div className=\"gem-stats\">{stats}</div>\n              <div className=\"reservedStat\">\n                {reserved}\n              </div>\n            </div>\n          }\n        </div>\n      );\n    }\n  }\n\n  class Level extends React.PureComponent<{ name: string, remaining: number, game: Game, cards: CardT[] }, {}> {\n    render() {\n      return (\n        <div>\n          <div className={\"deck \" + this.props.name}>\n            <div className=\"remaining\">\n              {this.props.remaining}\n            </div>\n            <div className=\"overlay\"></div>\n            <div className=\"reserve\" onClick={this.props.game.reserve.bind(this.props.game, this.props.name)}>\n              <img className=\"floppy\" src=\"client/img/floppy.png\" />\n            </div>\n          </div>\n          <div className={\"c_\" + this.props.name + \" face-up-cards\"}>\n            <div className=\"cards-inner\">\n              {this.props.cards && this.props.cards.map((card) =>\n                <Card key={card.uuid} card={card} game={this.props.game}/>\n              )}\n            </div>\n          </div>\n        </div>\n      );\n    }\n  }\n\n  class Game extends React.PureComponent<{ gid: string, pid: number, uuid: string }, GameState> {\n    state = {\n      players: [],\n      gems: {},\n      cards: {},\n      chat: [],\n      decks: {},\n      nobles: [],\n      log: [],\n      turn: -1,\n      winner: null,\n      mode: \"normal\",\n      error: null,\n      selectedPlayer: -1,\n      phase: \"pregame\",\n      showChat: false,\n      showLog: false,\n      chatNotify: false,\n    } as GameState\n\n    isMyTurn = (turn: number) => {\n      return (turn == this.props.pid);\n    }\n\n    updateState = (r: ServerResponse) => {\n      if (r.state) {\n        var myTurn = this.isMyTurn(r.state.turn);\n        if (!myTurn) this.setState({mode: \"waiting\"});\n        else {\n          if (this.state.mode == \"waiting\") {\n            favicon.badge('!' as any);\n            (document.getElementById(\"notify\") as HTMLAudioElement).play();\n          }\n          this.setState({mode: \"normal\"});\n        }\n\n        if (this.state.selectedPlayer == -1 && this.props.pid < 4) {\n          this.setState({selectedPlayer: this.props.pid});\n        }\n\n        this.setState({\n          log: r.state.log,\n          cards: r.state.cards,\n          decks: r.state.decks,\n          players: r.state.players,\n          gems: r.state.gems,\n          nobles: r.state.nobles,\n          turn: r.state.turn,\n        });\n\n        if (r.state.winner !== null && this.state.phase != \"postgame\") {\n          alert(r.state.players[r.state.winner].name + \" wins!\");\n          this.setState({phase: \"postgame\"});\n        }\n\n        if (r.chat) {\n          var chat = this.state.chat;\n          if (chat && chat[chat.length - 1] && r.chat[r.chat.length -1]) {\n            var lastLocalChat = chat[chat.length - 1];\n            var lastRemoteChat = r.chat[r.chat.length - 1];\n            if (lastLocalChat.msg != lastRemoteChat.msg && lastRemoteChat.pid != this.props.pid) {\n              favicon.badge('.' as any);\n              (document.getElementById(\"notify\") as HTMLAudioElement).play();\n              if (!this.state.showChat) this.setState({ chatNotify: true })\n            }\n          }\n          this.setState({ chat: r.chat });\n        }\n\n        for (const scroller of document.getElementsByClassName(\"scroller\")) {\n          scroller.scrollTop = scroller.scrollHeight\n        }\n      }\n    }\n\n    loginArgs = () => {\n      return '?pid=' + this.props.pid + '&uuid=' + this.props.uuid\n    }\n\n    take = (color: string) => {\n      this.act('take', color)\n    }\n\n    discard = (color: string) => {\n      if (confirm(\"Are you sure you want to discard a gem?\")) {\n        this.act('discard', color)\n      }\n    }\n\n    selectPlayer = (player: number) => {\n      this.setState({ selectedPlayer: player })\n    }\n\n    buy = (uuid: string) => {\n      this.act('buy', uuid)\n    }\n\n    reserve = (uuid: string) => {\n      this.act('reserve', uuid)\n    }\n\n    noble = (uuid: string) => {\n      this.act('noble_visit', uuid);\n    }\n\n    rename = async (name: string) => {\n      const resp = await fetch(`/rename/${this.props.gid}/${name}${this.loginArgs()}`, { method: 'POST' })\n      const json = await resp.json()\n      globalShowError(json)\n    }\n\n    act = async (action: string, target: string) => {\n      const resp = await fetch('/game/' + this.props.gid + '/' + action + '/' + target + this.loginArgs(), { method: 'POST' })\n      const json = await resp.json()\n      if (!globalShowError(json)) this.updateState(json)\n    }\n\n    nextTurn = async () => {\n      const resp = await fetch('/game/' + this.props.gid + '/next' + this.loginArgs(), { method: 'POST' })\n      const json = await resp.json()\n      if (!globalShowError(json)) this.updateState(json)\n    }\n\n    poll = async () => {\n      const resp = await fetch('/poll/' + this.props.gid + this.loginArgs())\n      const json = await resp.json()\n      if (!globalShowError(json)) {\n        this.updateState(json)\n        this.poll()\n      }\n    }\n\n    stat = async () => {\n      const resp = await fetch(`/stat/${this.props.gid}${this.loginArgs()}`)\n      const json = await resp.json()\n      if (!globalShowError(json)) this.updateState(json)\n    }\n\n    componentDidMount() {\n      this.stat()\n      this.poll()\n    }\n\n    chat = async (e: React.KeyboardEvent<HTMLInputElement>) => {\n      const chatBox = document.getElementById(\"chat-inner\") as HTMLInputElement\n      if (e.which == 13) {\n        const resp = await fetch('/game/' + this.props.gid + '/chat' + this.loginArgs(), {\n          method: 'POST',\n          body: JSON.stringify({ msg: chatBox.value }),\n        })\n        chatBox.value = \"\"\n        const json = await resp.json()\n        if (!globalShowError(json)) this.updateState(json)\n      }\n    }\n\n    render() {\n      var players = this.state.players.map((player) => {\n        return (\n          <Player\n            selectedPlayer={this.state.selectedPlayer}\n            key={player.uuid}\n            pid={player.id}\n            name={player.name}\n            points={player.score}\n            game={this}\n            cards={player.cards}\n            nobles={player.nobles}\n            gems={player.gems}\n            reserved={player.reserved}\n            nreserved={player.reserved.length}\n          />\n        );\n      });\n      var gems = mapColors(this.state.gems, this, this.take, '', 'game');\n      var nobles = mapNobles(this.state.nobles, this);\n      var log = this.state.log.map((logLine, i) => {\n        return (\n          <div key={\"log-line-\" + i} className=\"line\">\n            <span className=\"pid\">{\"[\" + logLine.pid + \"] \"}</span>\n            <span className=\"msg\">{logLine.msg}</span>\n          </div>\n        );\n      });\n      var chat = this.state.chat.map((chatLine, i) => {\n        return (\n          <div key={\"chat-line-\" + i} className=\"line\">\n            <span className={`name name${chatLine.pid}`}>{chatLine.name + \": \"}</span>\n            <span className=\"msg\">{chatLine.msg}</span>\n          </div>\n        );\n      });\n      var levels = levelNames.map((level) => {\n        return (\n          <Level\n            key = {level}\n            game = {this}\n            name = {level}\n            cards = {this.state.cards[level]}\n            remaining = {this.state.decks[level]}\n          />\n        )\n      });\n      return (\n        <div>\n          <div id=\"game-board\">\n            <div id=\"common-area\">\n              <div id=\"noble-area\" className=\"split\">\n                {nobles}\n              </div>\n              <div id=\"level-area\" className=\"split\">\n                {levels}\n              </div>\n              <div className=\"reserve-info\">\n                <div className=\"reserve-info-inner\">\n                  <div>Click on card to buy, click on </div><div><img className=\"floppy\" src=\"client/img/floppy.png\" /></div><div> to reserve.</div>\n                </div>\n              </div>\n              <div id=\"gem-area\" className=\"you\">\n                {gems}\n              </div>\n            </div>\n            <div id=\"player-area\">\n              {players}\n            </div>\n          </div>\n          <div id=\"log-box\" style={{ bottom: this.state.showLog ? -4 : -514 }}>\n            <div className=\"title\" onClick={() => this.setState({ showLog: !this.state.showLog })}>::Log</div>\n            <div className=\"scroller\">\n              {log}\n            </div>\n          </div>\n          <div id=\"chat-box\" onClick={() => this.setState({ chatNotify: false })} style={{ bottom: this.state.showChat ? -4 : -314 }}>\n            <div className={`title${ this.state.chatNotify ? \" blinking\" : \"\"}`} onClick={() => this.setState({ showChat: !this.state.showChat })}>::Chat</div>\n            <div className=\"scroller\">\n              {chat}\n            </div>\n            <div id=\"chat\">\n              <span id=\"prompt\">&gt;</span>\n              <input id=\"chat-inner\" type=\"text\" onKeyPress={this.chat}></input>\n            </div>\n          </div>\n          {this.state.turn >= 0 && this.props.pid >= 0 && this.props.pid < 4 &&\n            <button id={`pass-turn`} onClick={this.nextTurn} style={{ opacity: this.isMyTurn(this.state.turn) ? 1 : 0.3 }}>Pass turn</button>\n          }\n        </div>\n      );\n    }\n  }\n\n  const ErrorMsg = (props: { error: string | null, opacity: number }) => {\n    return <div className=\"error-box\" style={{ opacity: props.opacity }}>\n      <div className=\"error-box-inner\">{props.error}</div>\n    </div>\n  }\n\n  interface GameCreatorState {\n    startKey: string | null\n    loading: boolean\n    lobby: boolean\n    gameName: string\n    joined: boolean\n    pid: number\n    uuid: string\n    gid: string\n    error: string | null\n    errorOpacity: number\n  }\n\n  class GameCreator extends React.PureComponent<{}, GameCreatorState> {\n    state = {\n      startKey: null,\n      loading: true,\n      lobby: false,\n      joined: false,\n      pid: -1,\n      uuid: '',\n      gid: '',\n      gameName: '',\n      errorOpacity: 0,\n      error: null,\n    } as GameCreatorState\n\n    creating = false\n\n    join = async (game: string, act: string) => {\n      const session = this.readSession()\n      if (session[game] && !session[game].loading && (session[game].joined || act === 'spectate')) {\n        this.setState(session[game]);\n        this.save();\n        return;\n      }\n\n      const resp = await fetch(`/${act}/${game}`, { method: 'POST' })\n      const json = await resp.json()\n      if (json.status === 404) {\n        this.createGame()\n        return\n      }\n\n      if (this.showError(json)) return\n\n      this.setState({\n        joined: (act === 'join'),\n        loading: false,\n        pid: json.id,\n        uuid: json.uuid,\n        gid: game,\n      })\n      this.save()\n    }\n\n    showError = (resp: ServerResponse): boolean => {\n      let msg: string | null = null\n      if (!resp) {\n        msg = \"Request failed\";\n        return true\n      }\n      else if (!resp.error && (!resp.result || !resp.result.error)) return false;\n      else msg = resp.error || resp.result.error;\n\n      if (resp.status === 404) {\n        this.clear()\n        this.setState({ loading: true, joined: false, pid: -1, uuid: '' })\n        this.join(this.state.gid, 'spectate')\n        return true\n      }\n\n      this.setState({ error: msg, errorOpacity: 1 })\n\n      clearTimeout(errorTimeout);\n      errorTimeout = setTimeout(() => {\n        this.setState({ errorOpacity: 0 })\n      }, 4000)\n\n      return true\n    }\n\n    createGame = async () => {\n      if (this.creating) return\n      this.creating = true\n      const gameName = this.state.gid === '' ? this.state.gameName : this.state.gid\n      const resp = await fetch(`/create/${gameName}`, { method: \"POST\" })\n      const json = await resp.json()\n\n      if (this.showError(json)) return\n\n      history.replaceState(null, \"Splendor\", `/${json.game}`)\n      this.join(json.game, 'join')\n      this.setState({ startKey: json.start, loading: true, lobby: false })\n    }\n\n    readSession = () => {\n      var session = window.localStorage.getItem('splendor');\n      if (session === null) return {};\n      return JSON.parse(session);\n    }\n\n    componentDidMount() {\n      globalShowError = this.showError\n\n      if (window.location.pathname === \"/\") {\n        fetch(`/suggest`).then(async (resp) => {\n          const json = await resp.json()\n          this.setState({\n            lobby: true,\n            gameName: json.result.game,\n            loading: false,\n          })\n        })\n        return\n      }\n\n      const gid = window.location.pathname.substring(1)\n      var session = this.readSession()\n      this.setState({\n        ...session[gid],\n        gid,\n      })\n      if (this.state.loading) {\n        this.join(gid, 'spectate')\n      }\n    }\n\n    save = () => {\n      setTimeout(() => {\n        this.saveRaw(this.state)\n      }, 100)\n    }\n\n    clear = () => {\n      this.saveRaw(null)\n    }\n\n    saveRaw = (state: any) => {\n      const session = this.readSession();\n      if (state === null) delete session[this.state.gid]\n      else session[this.state.gid] = state\n      window.localStorage['splendor'] = JSON.stringify(session);\n    }\n\n    startGame = async () => {\n      const resp = await fetch(`/start/${this.state.gid}/${this.state.startKey}`, { method: \"POST\" })\n      const json = await resp.json()\n\n      if (!this.showError(json)) {\n        this.setState({ startKey: null });\n        this.save();\n      }\n    }\n\n    nameChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n      this.setState({ gameName: e.target.value })\n    }\n\n    keyPress = (e: React.KeyboardEvent<HTMLInputElement>) => {\n      if (e.key === \"Enter\") this.createGame()\n    }\n\n    render() {\n      if (this.state.loading) {\n        return <div id=\"game\">\n          <ErrorMsg error={this.state.error} opacity={this.state.errorOpacity} />\n        </div>\n      }\n\n      if (this.state.lobby) {\n        return <div className=\"lobby\">\n          <div className=\"main-title\">Splendor</div>\n          <div className=\"desc\">Play Splendor online with others. Enter a game name or use the suggested game name to start a game.</div>\n          <div className=\"name\">\n            <input className=\"game-name\" type=\"text\" onChange={this.nameChange} onKeyPress={this.keyPress} value={this.state.gameName} />\n            <button onClick={this.createGame} className=\"create-game\">Create Game</button>\n          </div>\n          <ErrorMsg error={this.state.error} opacity={this.state.errorOpacity} />\n        </div>\n      }\n\n      return (\n        <div id=\"game\">\n          <div id=\"game-title\">\n            <div className=\"link\">\n              Share this link with friends to join in or watch: <a href=\".\">{`${document.location.href}`}</a>\n            </div>\n            <div className=\"buttons\">\n              {!this.state.joined &&\n                <button className=\"start-game\" onClick={() => this.join(this.state.gid, 'join')}>Join Game</button>\n              }\n              {this.state.startKey && this.state.pid == 0 &&\n                <button className=\"start-game\" onClick={this.startGame}>Start Game</button>\n              }\n            </div>\n          </div>\n          {this.state.pid >= 0 && this.state.gid && this.state.uuid &&\n            <Game key={this.state.pid} gid={this.state.gid} pid={this.state.pid} uuid={this.state.uuid} />\n          }\n          <ErrorMsg error={this.state.error} opacity={this.state.errorOpacity} />\n        </div>\n      )\n    }\n  }\n\n  const favicon=new Favico({\n    position : 'up'\n  })\n\n  document.onclick = () => {\n    favicon.badge('' as any)\n  }\n\n  ReactDOM.render(\n    <div>\n      <GameCreator />\n    </div>,\n    document.getElementById('content')\n  )\n})()\n","module.exports = React;","module.exports = ReactDOM;","/**\n * @license MIT\n * @fileOverview Favico animations\n * @author Miroslav Magda, http://blog.ejci.net\n * @version 0.3.10\n */\n\n/**\n * Create new favico instance\n * @param {Object} Options\n * @return {Object} Favico object\n * @example\n * var favico = new Favico({\n *    bgColor : '#d00',\n *    textColor : '#fff',\n *    fontFamily : 'sans-serif',\n *    fontStyle : 'bold',\n *    position : 'down',\n *    type : 'circle',\n *    animation : 'slide',\n *    dataUrl: function(url){},\n *    win: top\n * });\n */\n(function () {\n\n\tvar Favico = (function (opt) {\n\t\t'use strict';\n\t\topt = (opt) ? opt : {};\n\t\tvar _def = {\n\t\t\tbgColor: '#d00',\n\t\t\ttextColor: '#fff',\n\t\t\tfontFamily: 'sans-serif', //Arial,Verdana,Times New Roman,serif,sans-serif,...\n\t\t\tfontStyle: 'bold', //normal,italic,oblique,bold,bolder,lighter,100,200,300,400,500,600,700,800,900\n\t\t\ttype: 'circle',\n\t\t\tposition: 'down', // down, up, left, leftup (upleft)\n\t\t\tanimation: 'slide',\n\t\t\telementId: false,\n\t\t\tdataUrl: false,\n\t\t\twin: window\n\t\t};\n\t\tvar _opt, _orig, _h, _w, _canvas, _context, _img, _ready, _lastBadge, _running, _readyCb, _stop, _browser, _animTimeout, _drawTimeout, _doc;\n\n\t\t_browser = {};\n\t\t_browser.ff = typeof InstallTrigger != 'undefined';\n\t\t_browser.chrome = !!window.chrome;\n\t\t_browser.opera = !!window.opera || navigator.userAgent.indexOf('Opera') >= 0;\n\t\t_browser.ie = /*@cc_on!@*/false;\n\t\t_browser.safari = Object.prototype.toString.call(window.HTMLElement).indexOf('Constructor') > 0;\n\t\t_browser.supported = (_browser.chrome || _browser.ff || _browser.opera);\n\n\t\tvar _queue = [];\n\t\t_readyCb = function () {\n\t\t};\n\t\t_ready = _stop = false;\n\t\t/**\n\t\t * Initialize favico\n\t\t */\n\t\tvar init = function () {\n\t\t\t//merge initial options\n\t\t\t_opt = merge(_def, opt);\n\t\t\t_opt.bgColor = hexToRgb(_opt.bgColor);\n\t\t\t_opt.textColor = hexToRgb(_opt.textColor);\n\t\t\t_opt.position = _opt.position.toLowerCase();\n\t\t\t_opt.animation = (animation.types['' + _opt.animation]) ? _opt.animation : _def.animation;\n\n\t\t\t_doc = _opt.win.document;\n\n\t\t\tvar isUp = _opt.position.indexOf('up') > -1;\n\t\t\tvar isLeft = _opt.position.indexOf('left') > -1;\n\n\t\t\t//transform animation\n\t\t\tif (isUp || isLeft) {\n\t\t\t\tfor (var i = 0; i < animation.types['' + _opt.animation].length; i++) {\n\t\t\t\t\tvar step = animation.types['' + _opt.animation][i];\n\n\t\t\t\t\tif (isUp) {\n\t\t\t\t\t\tif (step.y < 0.6) {\n\t\t\t\t\t\t\tstep.y = step.y - 0.4;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstep.y = step.y - 2 * step.y + (1 - step.w);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isLeft) {\n\t\t\t\t\t\tif (step.x < 0.6) {\n\t\t\t\t\t\t\tstep.x = step.x - 0.4;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstep.x = step.x - 2 * step.x + (1 - step.h);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tanimation.types['' + _opt.animation][i] = step;\n\t\t\t\t}\n\t\t\t}\n\t\t\t_opt.type = (type['' + _opt.type]) ? _opt.type : _def.type;\n\n\t\t\t_orig = link.getIcon();\n\t\t\t//create temp canvas\n\t\t\t_canvas = document.createElement('canvas');\n\t\t\t//create temp image\n\t\t\t_img = document.createElement('img');\n\t\t\tif (_orig.hasAttribute('href')) {\n\t\t\t\t_img.setAttribute('crossOrigin', 'anonymous');\n\t\t\t\t//get width/height\n\t\t\t\t_img.onload = function () {\n\t\t\t\t\t_h = (_img.height > 0) ? _img.height : 32;\n\t\t\t\t\t_w = (_img.width > 0) ? _img.width : 32;\n\t\t\t\t\t_canvas.height = _h;\n\t\t\t\t\t_canvas.width = _w;\n\t\t\t\t\t_context = _canvas.getContext('2d');\n\t\t\t\t\ticon.ready();\n\t\t\t\t};\n\t\t\t\t_img.setAttribute('src', _orig.getAttribute('href'));\n\t\t\t} else {\n\t\t\t\t_img.onload = function () {\n\t\t\t\t\t_h = 32;\n\t\t\t\t\t_w = 32;\n\t\t\t\t\t_img.height = _h;\n\t\t\t\t\t_img.width = _w;\n\t\t\t\t\t_canvas.height = _h;\n\t\t\t\t\t_canvas.width = _w;\n\t\t\t\t\t_context = _canvas.getContext('2d');\n\t\t\t\t\ticon.ready();\n\t\t\t\t};\n\t\t\t\t_img.setAttribute('src', '');\n\t\t\t}\n\n\t\t};\n\t\t/**\n\t\t * Icon namespace\n\t\t */\n\t\tvar icon = {};\n\t\t/**\n\t\t * Icon is ready (reset icon) and start animation (if ther is any)\n\t\t */\n\t\ticon.ready = function () {\n\t\t\t_ready = true;\n\t\t\ticon.reset();\n\t\t\t_readyCb();\n\t\t};\n\t\t/**\n\t\t * Reset icon to default state\n\t\t */\n\t\ticon.reset = function () {\n\t\t\t//reset\n\t\t\tif (!_ready) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t_queue = [];\n\t\t\t_lastBadge = false;\n\t\t\t_running = false;\n\t\t\t_context.clearRect(0, 0, _w, _h);\n\t\t\t_context.drawImage(_img, 0, 0, _w, _h);\n\t\t\t//_stop=true;\n\t\t\tlink.setIcon(_canvas);\n\t\t\t//webcam('stop');\n\t\t\t//video('stop');\n\t\t\twindow.clearTimeout(_animTimeout);\n\t\t\twindow.clearTimeout(_drawTimeout);\n\t\t};\n\t\t/**\n\t\t * Start animation\n\t\t */\n\t\ticon.start = function () {\n\t\t\tif (!_ready || _running) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar finished = function () {\n\t\t\t\t_lastBadge = _queue[0];\n\t\t\t\t_running = false;\n\t\t\t\tif (_queue.length > 0) {\n\t\t\t\t\t_queue.shift();\n\t\t\t\t\ticon.start();\n\t\t\t\t} else {\n\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (_queue.length > 0) {\n\t\t\t\t_running = true;\n\t\t\t\tvar run = function () {\n\t\t\t\t\t// apply options for this animation\n\t\t\t\t\t['type', 'animation', 'bgColor', 'textColor', 'fontFamily', 'fontStyle'].forEach(function (a) {\n\t\t\t\t\t\tif (a in _queue[0].options) {\n\t\t\t\t\t\t\t_opt[a] = _queue[0].options[a];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tanimation.run(_queue[0].options, function () {\n\t\t\t\t\t\tfinished();\n\t\t\t\t\t}, false);\n\t\t\t\t};\n\t\t\t\tif (_lastBadge) {\n\t\t\t\t\tanimation.run(_lastBadge.options, function () {\n\t\t\t\t\t\trun();\n\t\t\t\t\t}, true);\n\t\t\t\t} else {\n\t\t\t\t\trun();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Badge types\n\t\t */\n\t\tvar type = {};\n\t\tvar options = function (opt) {\n\t\t\topt.n = ((typeof opt.n) === 'number') ? Math.abs(opt.n | 0) : opt.n;\n\t\t\topt.x = _w * opt.x;\n\t\t\topt.y = _h * opt.y;\n\t\t\topt.w = _w * opt.w;\n\t\t\topt.h = _h * opt.h;\n\t\t\topt.len = (\"\" + opt.n).length;\n\t\t\treturn opt;\n\t\t};\n\t\t/**\n\t\t * Generate circle\n\t\t * @param {Object} opt Badge options\n\t\t */\n\t\ttype.circle = function (opt) {\n\t\t\topt = options(opt);\n\t\t\tvar more = false;\n\t\t\tif (opt.len === 2) {\n\t\t\t\topt.x = opt.x - opt.w * 0.4;\n\t\t\t\topt.w = opt.w * 1.4;\n\t\t\t\tmore = true;\n\t\t\t} else if (opt.len >= 3) {\n\t\t\t\topt.x = opt.x - opt.w * 0.65;\n\t\t\t\topt.w = opt.w * 1.65;\n\t\t\t\tmore = true;\n\t\t\t}\n\t\t\t_context.clearRect(0, 0, _w, _h);\n\t\t\t_context.drawImage(_img, 0, 0, _w, _h);\n\t\t\t_context.beginPath();\n\t\t\t_context.font = _opt.fontStyle + \" \" + Math.floor(opt.h * (opt.n > 99 ? 0.85 : 1)) + \"px \" + _opt.fontFamily;\n\t\t\t_context.textAlign = 'center';\n\t\t\tif (more) {\n\t\t\t\t_context.moveTo(opt.x + opt.w / 2, opt.y);\n\t\t\t\t_context.lineTo(opt.x + opt.w - opt.h / 2, opt.y);\n\t\t\t\t_context.quadraticCurveTo(opt.x + opt.w, opt.y, opt.x + opt.w, opt.y + opt.h / 2);\n\t\t\t\t_context.lineTo(opt.x + opt.w, opt.y + opt.h - opt.h / 2);\n\t\t\t\t_context.quadraticCurveTo(opt.x + opt.w, opt.y + opt.h, opt.x + opt.w - opt.h / 2, opt.y + opt.h);\n\t\t\t\t_context.lineTo(opt.x + opt.h / 2, opt.y + opt.h);\n\t\t\t\t_context.quadraticCurveTo(opt.x, opt.y + opt.h, opt.x, opt.y + opt.h - opt.h / 2);\n\t\t\t\t_context.lineTo(opt.x, opt.y + opt.h / 2);\n\t\t\t\t_context.quadraticCurveTo(opt.x, opt.y, opt.x + opt.h / 2, opt.y);\n\t\t\t} else {\n\t\t\t\t_context.arc(opt.x + opt.w / 2, opt.y + opt.h / 2, opt.h / 2, 0, 2 * Math.PI);\n\t\t\t}\n\t\t\t_context.fillStyle = 'rgba(' + _opt.bgColor.r + ',' + _opt.bgColor.g + ',' + _opt.bgColor.b + ',' + opt.o + ')';\n\t\t\t_context.fill();\n\t\t\t_context.closePath();\n\t\t\t_context.beginPath();\n\t\t\t_context.stroke();\n\t\t\t_context.fillStyle = 'rgba(' + _opt.textColor.r + ',' + _opt.textColor.g + ',' + _opt.textColor.b + ',' + opt.o + ')';\n\t\t\t//_context.fillText((more) ? '9+' : opt.n, Math.floor(opt.x + opt.w / 2), Math.floor(opt.y + opt.h - opt.h * 0.15));\n\t\t\tif ((typeof opt.n) === 'number' && opt.n > 999) {\n\t\t\t\t_context.fillText(((opt.n > 9999) ? 9 : Math.floor(opt.n / 1000)) + 'k+', Math.floor(opt.x + opt.w / 2), Math.floor(opt.y + opt.h - opt.h * 0.2));\n\t\t\t} else {\n\t\t\t\t_context.fillText(opt.n, Math.floor(opt.x + opt.w / 2), Math.floor(opt.y + opt.h - opt.h * 0.15));\n\t\t\t}\n\t\t\t_context.closePath();\n\t\t};\n\t\t/**\n\t\t * Generate rectangle\n\t\t * @param {Object} opt Badge options\n\t\t */\n\t\ttype.rectangle = function (opt) {\n\t\t\topt = options(opt);\n\t\t\tvar more = false;\n\t\t\tif (opt.len === 2) {\n\t\t\t\topt.x = opt.x - opt.w * 0.4;\n\t\t\t\topt.w = opt.w * 1.4;\n\t\t\t\tmore = true;\n\t\t\t} else if (opt.len >= 3) {\n\t\t\t\topt.x = opt.x - opt.w * 0.65;\n\t\t\t\topt.w = opt.w * 1.65;\n\t\t\t\tmore = true;\n\t\t\t}\n\t\t\t_context.clearRect(0, 0, _w, _h);\n\t\t\t_context.drawImage(_img, 0, 0, _w, _h);\n\t\t\t_context.beginPath();\n\t\t\t_context.font = _opt.fontStyle + \" \" + Math.floor(opt.h * (opt.n > 99 ? 0.9 : 1)) + \"px \" + _opt.fontFamily;\n\t\t\t_context.textAlign = 'center';\n\t\t\t_context.fillStyle = 'rgba(' + _opt.bgColor.r + ',' + _opt.bgColor.g + ',' + _opt.bgColor.b + ',' + opt.o + ')';\n\t\t\t_context.fillRect(opt.x, opt.y, opt.w, opt.h);\n\t\t\t_context.fillStyle = 'rgba(' + _opt.textColor.r + ',' + _opt.textColor.g + ',' + _opt.textColor.b + ',' + opt.o + ')';\n\t\t\t//_context.fillText((more) ? '9+' : opt.n, Math.floor(opt.x + opt.w / 2), Math.floor(opt.y + opt.h - opt.h * 0.15));\n\t\t\tif ((typeof opt.n) === 'number' && opt.n > 999) {\n\t\t\t\t_context.fillText(((opt.n > 9999) ? 9 : Math.floor(opt.n / 1000)) + 'k+', Math.floor(opt.x + opt.w / 2), Math.floor(opt.y + opt.h - opt.h * 0.2));\n\t\t\t} else {\n\t\t\t\t_context.fillText(opt.n, Math.floor(opt.x + opt.w / 2), Math.floor(opt.y + opt.h - opt.h * 0.15));\n\t\t\t}\n\t\t\t_context.closePath();\n\t\t};\n\n\t\t/**\n\t\t * Set badge\n\t\t */\n\t\tvar badge = function (number, opts) {\n\t\t\topts = ((typeof opts) === 'string' ? {\n\t\t\t\tanimation: opts\n\t\t\t} : opts) || {};\n\t\t\t_readyCb = function () {\n\t\t\t\ttry {\n\t\t\t\t\tif (typeof (number) === 'number' ? (number > 0) : (number !== '')) {\n\t\t\t\t\t\tvar q = {\n\t\t\t\t\t\t\ttype: 'badge',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tn: number\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif ('animation' in opts && animation.types['' + opts.animation]) {\n\t\t\t\t\t\t\tq.options.animation = '' + opts.animation;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ('type' in opts && type['' + opts.type]) {\n\t\t\t\t\t\t\tq.options.type = '' + opts.type;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t['bgColor', 'textColor'].forEach(function (o) {\n\t\t\t\t\t\t\tif (o in opts) {\n\t\t\t\t\t\t\t\tq.options[o] = hexToRgb(opts[o]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t['fontStyle', 'fontFamily'].forEach(function (o) {\n\t\t\t\t\t\t\tif (o in opts) {\n\t\t\t\t\t\t\t\tq.options[o] = opts[o];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t_queue.push(q);\n\t\t\t\t\t\tif (_queue.length > 100) {\n\t\t\t\t\t\t\tthrow new Error('Too many badges requests in queue.');\n\t\t\t\t\t\t}\n\t\t\t\t\t\ticon.start();\n\t\t\t\t\t} else {\n\t\t\t\t\t\ticon.reset();\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthrow new Error('Error setting badge. Message: ' + e.message);\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (_ready) {\n\t\t\t\t_readyCb();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Set image as icon\n\t\t */\n\t\tvar image = function (imageElement) {\n\t\t\t_readyCb = function () {\n\t\t\t\ttry {\n\t\t\t\t\tvar w = imageElement.width;\n\t\t\t\t\tvar h = imageElement.height;\n\t\t\t\t\tvar newImg = document.createElement('img');\n\t\t\t\t\tvar ratio = (w / _w < h / _h) ? (w / _w) : (h / _h);\n\t\t\t\t\tnewImg.setAttribute('crossOrigin', 'anonymous');\n\t\t\t\t\tnewImg.onload=function(){\n\t\t\t\t\t\t_context.clearRect(0, 0, _w, _h);\n\t\t\t\t\t\t_context.drawImage(newImg, 0, 0, _w, _h);\n\t\t\t\t\t\tlink.setIcon(_canvas);\n\t\t\t\t\t};\n\t\t\t\t\tnewImg.setAttribute('src', imageElement.getAttribute('src'));\n\t\t\t\t\tnewImg.height = (h / ratio);\n\t\t\t\t\tnewImg.width = (w / ratio);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthrow new Error('Error setting image. Message: ' + e.message);\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (_ready) {\n\t\t\t\t_readyCb();\n\t\t\t}\n\t\t};\n\t\t/**\n\t\t * Set video as icon\n\t\t */\n\t\tvar video = function (videoElement) {\n\t\t\t_readyCb = function () {\n\t\t\t\ttry {\n\t\t\t\t\tif (videoElement === 'stop') {\n\t\t\t\t\t\t_stop = true;\n\t\t\t\t\t\ticon.reset();\n\t\t\t\t\t\t_stop = false;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t//var w = videoElement.width;\n\t\t\t\t\t//var h = videoElement.height;\n\t\t\t\t\t//var ratio = (w / _w < h / _h) ? (w / _w) : (h / _h);\n\t\t\t\t\tvideoElement.addEventListener('play', function () {\n\t\t\t\t\t\tdrawVideo(this);\n\t\t\t\t\t}, false);\n\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthrow new Error('Error setting video. Message: ' + e.message);\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (_ready) {\n\t\t\t\t_readyCb();\n\t\t\t}\n\t\t};\n\t\t/**\n\t\t * Set video as icon\n\t\t */\n\t\tvar webcam = function (action) {\n\t\t\t//UR\n\t\t\tif (!window.URL || !window.URL.createObjectURL) {\n\t\t\t\twindow.URL = window.URL || {};\n\t\t\t\twindow.URL.createObjectURL = function (obj) {\n\t\t\t\t\treturn obj;\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (_browser.supported) {\n\t\t\t\tvar newVideo = false;\n\t\t\t\tnavigator.getUserMedia = navigator.getUserMedia || navigator.oGetUserMedia || navigator.msGetUserMedia || navigator.mozGetUserMedia || navigator.webkitGetUserMedia;\n\t\t\t\t_readyCb = function () {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (action === 'stop') {\n\t\t\t\t\t\t\t_stop = true;\n\t\t\t\t\t\t\ticon.reset();\n\t\t\t\t\t\t\t_stop = false;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnewVideo = document.createElement('video');\n\t\t\t\t\t\tnewVideo.width = _w;\n\t\t\t\t\t\tnewVideo.height = _h;\n\t\t\t\t\t\tnavigator.getUserMedia({\n\t\t\t\t\t\t\tvideo: true,\n\t\t\t\t\t\t\taudio: false\n\t\t\t\t\t\t}, function (stream) {\n\t\t\t\t\t\t\tnewVideo.src = URL.createObjectURL(stream);\n\t\t\t\t\t\t\tnewVideo.play();\n\t\t\t\t\t\t\tdrawVideo(newVideo);\n\t\t\t\t\t\t}, function () {\n\t\t\t\t\t\t});\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tthrow new Error('Error setting webcam. Message: ' + e.message);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (_ready) {\n\t\t\t\t\t_readyCb();\n\t\t\t\t}\n\t\t\t}\n\n\t\t};\n\n\t\t/**\n\t\t * Draw video to context and repeat :)\n\t\t */\n\t\tfunction drawVideo(video) {\n\t\t\tif (video.paused || video.ended || _stop) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t//nasty hack for FF webcam (Thanks to Julian Ćwirko, kontakt@redsunmedia.pl)\n\t\t\ttry {\n\t\t\t\t_context.clearRect(0, 0, _w, _h);\n\t\t\t\t_context.drawImage(video, 0, 0, _w, _h);\n\t\t\t} catch (e) {\n\n\t\t\t}\n\t\t\t_drawTimeout = setTimeout(function () {\n\t\t\t\tdrawVideo(video);\n\t\t\t}, animation.duration);\n\t\t\tlink.setIcon(_canvas);\n\t\t}\n\n\t\tvar link = {};\n\t\t/**\n\t\t * Get icon from HEAD tag or create a new <link> element\n\t\t */\n\t\tlink.getIcon = function () {\n\t\t\tvar elm = false;\n\t\t\t//get link element\n\t\t\tvar getLink = function () {\n\t\t\t\tvar link = _doc.getElementsByTagName('head')[0].getElementsByTagName('link');\n\t\t\t\tfor (var l = link.length, i = (l - 1); i >= 0; i--) {\n\t\t\t\t\tif ((/(^|\\s)icon(\\s|$)/i).test(link[i].getAttribute('rel'))) {\n\t\t\t\t\t\treturn link[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t};\n\t\t\tif (_opt.element) {\n\t\t\t\telm = _opt.element;\n\t\t\t} else if (_opt.elementId) {\n\t\t\t\t//if img element identified by elementId\n\t\t\t\telm = _doc.getElementById(_opt.elementId);\n\t\t\t\telm.setAttribute('href', elm.getAttribute('src'));\n\t\t\t} else {\n\t\t\t\t//if link element\n\t\t\t\telm = getLink();\n\t\t\t\tif (elm === false) {\n\t\t\t\t\telm = _doc.createElement('link');\n\t\t\t\t\telm.setAttribute('rel', 'icon');\n\t\t\t\t\t_doc.getElementsByTagName('head')[0].appendChild(elm);\n\t\t\t\t}\n\t\t\t}\n\t\t\telm.setAttribute('type', 'image/png');\n\t\t\treturn elm;\n\t\t};\n\t\tlink.setIcon = function (canvas) {\n\t\t\tvar url = canvas.toDataURL('image/png');\n\t\t\tif (_opt.dataUrl) {\n\t\t\t\t//if using custom exporter\n\t\t\t\t_opt.dataUrl(url);\n\t\t\t}\n\t\t\tif (_opt.element) {\n\t\t\t\t_opt.element.setAttribute('href', url);\n\t\t\t\t_opt.element.setAttribute('src', url);\n\t\t\t} else if (_opt.elementId) {\n\t\t\t\t//if is attached to element (image)\n\t\t\t\tvar elm = _doc.getElementById(_opt.elementId);\n\t\t\t\telm.setAttribute('href', url);\n\t\t\t\telm.setAttribute('src', url);\n\t\t\t} else {\n\t\t\t\t//if is attached to fav icon\n\t\t\t\tif (_browser.ff || _browser.opera) {\n\t\t\t\t\t//for FF we need to \"recreate\" element, atach to dom and remove old <link>\n\t\t\t\t\t//var originalType = _orig.getAttribute('rel');\n\t\t\t\t\tvar old = _orig;\n\t\t\t\t\t_orig = _doc.createElement('link');\n\t\t\t\t\t//_orig.setAttribute('rel', originalType);\n\t\t\t\t\tif (_browser.opera) {\n\t\t\t\t\t\t_orig.setAttribute('rel', 'icon');\n\t\t\t\t\t}\n\t\t\t\t\t_orig.setAttribute('rel', 'icon');\n\t\t\t\t\t_orig.setAttribute('type', 'image/png');\n\t\t\t\t\t_doc.getElementsByTagName('head')[0].appendChild(_orig);\n\t\t\t\t\t_orig.setAttribute('href', url);\n\t\t\t\t\tif (old.parentNode) {\n\t\t\t\t\t\told.parentNode.removeChild(old);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t_orig.setAttribute('href', url);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t//http://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb#answer-5624139\n\t\t//HEX to RGB convertor\n\t\tfunction hexToRgb(hex) {\n\t\t\tvar shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n\t\t\thex = hex.replace(shorthandRegex, function (m, r, g, b) {\n\t\t\t\treturn r + r + g + g + b + b;\n\t\t\t});\n\t\t\tvar result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n\t\t\treturn result ? {\n\t\t\t\tr: parseInt(result[1], 16),\n\t\t\t\tg: parseInt(result[2], 16),\n\t\t\t\tb: parseInt(result[3], 16)\n\t\t\t} : false;\n\t\t}\n\n\t\t/**\n\t\t * Merge options\n\t\t */\n\t\tfunction merge(def, opt) {\n\t\t\tvar mergedOpt = {};\n\t\t\tvar attrname;\n\t\t\tfor (attrname in def) {\n\t\t\t\tmergedOpt[attrname] = def[attrname];\n\t\t\t}\n\t\t\tfor (attrname in opt) {\n\t\t\t\tmergedOpt[attrname] = opt[attrname];\n\t\t\t}\n\t\t\treturn mergedOpt;\n\t\t}\n\n\t\t/**\n\t\t * Cross-browser page visibility shim\n\t\t * http://stackoverflow.com/questions/12536562/detect-whether-a-window-is-visible\n\t\t */\n\t\tfunction isPageHidden() {\n\t\t\treturn _doc.hidden || _doc.msHidden || _doc.webkitHidden || _doc.mozHidden;\n\t\t}\n\n\t\t/**\n\t\t * @namespace animation\n\t\t */\n\t\tvar animation = {};\n\t\t/**\n\t\t * Animation \"frame\" duration\n\t\t */\n\t\tanimation.duration = 40;\n\t\t/**\n\t\t * Animation types (none,fade,pop,slide)\n\t\t */\n\t\tanimation.types = {};\n\t\tanimation.types.fade = [{\n\t\t\tx: 0.4,\n\t\t\ty: 0.4,\n\t\t\tw: 0.6,\n\t\t\th: 0.6,\n\t\t\to: 0.0\n\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.4,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 0.1\n\t\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.4,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 0.2\n\t\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.4,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 0.3\n\t\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.4,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 0.4\n\t\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.4,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 0.5\n\t\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.4,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 0.6\n\t\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.4,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 0.7\n\t\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.4,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 0.8\n\t\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.4,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 0.9\n\t\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.4,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 1.0\n\t\t\t}];\n\t\tanimation.types.none = [{\n\t\t\tx: 0.4,\n\t\t\ty: 0.4,\n\t\t\tw: 0.6,\n\t\t\th: 0.6,\n\t\t\to: 1\n\t\t}];\n\t\tanimation.types.pop = [{\n\t\t\tx: 1,\n\t\t\ty: 1,\n\t\t\tw: 0,\n\t\t\th: 0,\n\t\t\to: 1\n\t\t}, {\n\t\t\t\tx: 0.9,\n\t\t\t\ty: 0.9,\n\t\t\t\tw: 0.1,\n\t\t\t\th: 0.1,\n\t\t\t\to: 1\n\t\t\t}, {\n\t\t\t\tx: 0.8,\n\t\t\t\ty: 0.8,\n\t\t\t\tw: 0.2,\n\t\t\t\th: 0.2,\n\t\t\t\to: 1\n\t\t\t}, {\n\t\t\t\tx: 0.7,\n\t\t\t\ty: 0.7,\n\t\t\t\tw: 0.3,\n\t\t\t\th: 0.3,\n\t\t\t\to: 1\n\t\t\t}, {\n\t\t\t\tx: 0.6,\n\t\t\t\ty: 0.6,\n\t\t\t\tw: 0.4,\n\t\t\t\th: 0.4,\n\t\t\t\to: 1\n\t\t\t}, {\n\t\t\t\tx: 0.5,\n\t\t\t\ty: 0.5,\n\t\t\t\tw: 0.5,\n\t\t\t\th: 0.5,\n\t\t\t\to: 1\n\t\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.4,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 1\n\t\t\t}];\n\t\tanimation.types.popFade = [{\n\t\t\tx: 0.75,\n\t\t\ty: 0.75,\n\t\t\tw: 0,\n\t\t\th: 0,\n\t\t\to: 0\n\t\t}, {\n\t\t\t\tx: 0.65,\n\t\t\t\ty: 0.65,\n\t\t\t\tw: 0.1,\n\t\t\t\th: 0.1,\n\t\t\t\to: 0.2\n\t\t\t}, {\n\t\t\t\tx: 0.6,\n\t\t\t\ty: 0.6,\n\t\t\t\tw: 0.2,\n\t\t\t\th: 0.2,\n\t\t\t\to: 0.4\n\t\t\t}, {\n\t\t\t\tx: 0.55,\n\t\t\t\ty: 0.55,\n\t\t\t\tw: 0.3,\n\t\t\t\th: 0.3,\n\t\t\t\to: 0.6\n\t\t\t}, {\n\t\t\t\tx: 0.50,\n\t\t\t\ty: 0.50,\n\t\t\t\tw: 0.4,\n\t\t\t\th: 0.4,\n\t\t\t\to: 0.8\n\t\t\t}, {\n\t\t\t\tx: 0.45,\n\t\t\t\ty: 0.45,\n\t\t\t\tw: 0.5,\n\t\t\t\th: 0.5,\n\t\t\t\to: 0.9\n\t\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.4,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 1\n\t\t\t}];\n\t\tanimation.types.slide = [{\n\t\t\tx: 0.4,\n\t\t\ty: 1,\n\t\t\tw: 0.6,\n\t\t\th: 0.6,\n\t\t\to: 1\n\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.9,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 1\n\t\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.9,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 1\n\t\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.8,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 1\n\t\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.7,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 1\n\t\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.6,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 1\n\t\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.5,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 1\n\t\t\t}, {\n\t\t\t\tx: 0.4,\n\t\t\t\ty: 0.4,\n\t\t\t\tw: 0.6,\n\t\t\t\th: 0.6,\n\t\t\t\to: 1\n\t\t\t}];\n\t\t/**\n\t\t * Run animation\n\t\t * @param {Object} opt Animation options\n\t\t * @param {Object} cb Callabak after all steps are done\n\t\t * @param {Object} revert Reverse order? true|false\n\t\t * @param {Object} step Optional step number (frame bumber)\n\t\t */\n\t\tanimation.run = function (opt, cb, revert, step) {\n\t\t\tvar animationType = animation.types[isPageHidden() ? 'none' : _opt.animation];\n\t\t\tif (revert === true) {\n\t\t\t\tstep = (typeof step !== 'undefined') ? step : animationType.length - 1;\n\t\t\t} else {\n\t\t\t\tstep = (typeof step !== 'undefined') ? step : 0;\n\t\t\t}\n\t\t\tcb = (cb) ? cb : function () {\n\t\t\t};\n\t\t\tif ((step < animationType.length) && (step >= 0)) {\n\t\t\t\ttype[_opt.type](merge(opt, animationType[step]));\n\t\t\t\t_animTimeout = setTimeout(function () {\n\t\t\t\t\tif (revert) {\n\t\t\t\t\t\tstep = step - 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstep = step + 1;\n\t\t\t\t\t}\n\t\t\t\t\tanimation.run(opt, cb, revert, step);\n\t\t\t\t}, animation.duration);\n\n\t\t\t\tlink.setIcon(_canvas);\n\t\t\t} else {\n\t\t\t\tcb();\n\t\t\t\treturn;\n\t\t\t}\n\t\t};\n\t\t//auto init\n\t\tinit();\n\t\treturn {\n\t\t\tbadge: badge,\n\t\t\tvideo: video,\n\t\t\timage: image,\n\t\t\twebcam: webcam,\n\t\t\treset: icon.reset,\n\t\t\tbrowser: {\n\t\t\t\tsupported: _browser.supported\n\t\t\t}\n\t\t};\n\t});\n\n\t// AMD / RequireJS\n\tif (typeof define !== 'undefined' && define.amd) {\n\t\tdefine([], function () {\n\t\t\treturn Favico;\n\t\t});\n\t}\n\t// CommonJS\n\telse if (typeof module !== 'undefined' && module.exports) {\n\t\tmodule.exports = Favico;\n\t}\n\t// included directly via <script> tag\n\telse {\n\t\tthis.Favico = Favico;\n\t}\n\n})();\n"],"sourceRoot":""}